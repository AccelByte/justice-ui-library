import{jsx as t}from"react/jsx-runtime";import e,{Component as s}from"react";import"../../index-17611e33.js";import{m as n,S as o,b as a,d as i,e as l,n as r,_ as u,o as p,h as d,p as c,i as f,c as m}from"../../stateManager-845a3300.esm-b4e021da.js";import"../../index-3f17275b.js";import{n as h}from"../../createSelect-dfa42dfe.js";import"../../style-inject.es-1f59c1d0.js";import"../../memoize-one.esm-8827f1ac.js";import"../../unitless.esm-d94354fa.js";import"../../index-dd80248b.js";import"../../objectWithoutPropertiesLoose-982ef579.js";import"../../objectWithoutProperties-90b89624.js";import"../../inherits-d3723d19.js";import"../../setPrototypeOf-c6ba02e6.js";import"../../index-72b69d08.js";import"../../_commonjsHelpers-6e998e78.js";import"../../core.esm-a8712816.js";import"../../inheritsLoose-6fd5c6e3.js";var O,v,y,g={cacheOptions:!1,defaultOptions:!1,filterOption:null,isLoading:!1},j=n(o),L=h((O=j,y=v=function(t){a(o,s);var n=i(o);function o(t){var e;return l(this,o),(e=n.call(this)).select=void 0,e.lastRequest=void 0,e.mounted=!1,e.handleInputChange=function(t,s){var n=e.props,o=n.cacheOptions,a=n.onInputChange,i=r(t,s,a);if(!i)return delete e.lastRequest,void e.setState({inputValue:"",loadedInputValue:"",loadedOptions:[],isLoading:!1,passEmptyOptions:!1});if(o&&e.state.optionsCache[i])e.setState({inputValue:i,loadedInputValue:i,loadedOptions:e.state.optionsCache[i],isLoading:!1,passEmptyOptions:!1});else{var l=e.lastRequest={};e.setState({inputValue:i,isLoading:!0,passEmptyOptions:!e.state.loadedInputValue},(function(){e.loadOptions(i,(function(t){e.mounted&&l===e.lastRequest&&(delete e.lastRequest,e.setState((function(e){return{isLoading:!1,loadedInputValue:i,loadedOptions:t||[],passEmptyOptions:!1,optionsCache:t?u(u({},e.optionsCache),{},p({},i,t)):e.optionsCache}})))}))}))}return i},e.state={defaultOptions:Array.isArray(t.defaultOptions)?t.defaultOptions:void 0,inputValue:void 0!==t.inputValue?t.inputValue:"",isLoading:!0===t.defaultOptions,loadedOptions:[],passEmptyOptions:!1,optionsCache:{},prevDefaultOptions:void 0,prevCacheOptions:void 0},e}return d(o,[{key:"componentDidMount",value:function(){var t=this;this.mounted=!0;var e=this.props.defaultOptions,s=this.state.inputValue;!0===e&&this.loadOptions(s,(function(e){if(t.mounted){var s=!!t.lastRequest;t.setState({defaultOptions:e||[],isLoading:s})}}))}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"focus",value:function(){this.select.focus()}},{key:"blur",value:function(){this.select.blur()}},{key:"loadOptions",value:function(t,e){var s=this.props.loadOptions;if(!s)return e();var n=s(t,e);n&&"function"==typeof n.then&&n.then(e,(function(){return e()}))}},{key:"render",value:function(){var t=this,s=this.props;s.loadOptions;var n=s.isLoading,o=c(s,["loadOptions","isLoading"]),a=this.state,i=a.defaultOptions,l=a.inputValue,r=a.isLoading,u=a.loadedInputValue,p=a.loadedOptions,d=a.passEmptyOptions?[]:l&&u?p:i||[];return e.createElement(O,f({},o,{ref:function(e){t.select=e},options:d,isLoading:r||n,onInputChange:this.handleInputChange}))}}],[{key:"getDerivedStateFromProps",value:function(t,e){var s=t.cacheOptions!==e.prevCacheOptions?{prevCacheOptions:t.cacheOptions,optionsCache:{}}:{},n=t.defaultOptions!==e.prevDefaultOptions?{prevDefaultOptions:t.defaultOptions,defaultOptions:Array.isArray(t.defaultOptions)?t.defaultOptions:void 0}:{};return u(u({},s),n)}}]),o}(),v.defaultProps=g,y));const k=m,C=()=>t("i",{className:"icon-chevron-down"}),S=e=>t("div",{className:"styled-atlaskit-select__menu",children:t(m.MenuList,{className:"styled-atlaskit-select__menu-list",...e,children:e.children})}),V=({isMulti:s=!1,onChange:n,dataQa:o=null,dataQaProps:a=null,loadOptions:i,onLoadMoreOptions:l,...r})=>{const u=e.useRef(),p=e.useRef();return e.useLayoutEffect((()=>{l&&(()=>{if(!u.current)return;const t=u.current.select.select.select.controlRef,e=t.parentElement.parentElement;let s=e.querySelector(".styled-atlaskit-select__menu"),n=s?s.querySelector(".styled-atlaskit-select__menu-list"):null;const o=()=>{s=e.querySelector(".styled-atlaskit-select__menu"),n=s?s.querySelector(".styled-atlaskit-select__menu-list"):null,n&&n.addEventListener("scroll",(t=>{const{scrollHeight:e,scrollTop:s,offsetHeight:n}=t.currentTarget,o=u.current.select.state,a=o.loadedOptions.length>0?o.loadedOptions:o.defaultOptions,i=o.loadedOptions.length>0?"loadedOptions":"defaultOptions";s>=e-(n+30)&&(p.current&&clearTimeout(p.current),p.current=setTimeout((async()=>{if(!l)return;u.current.select.setState({isLoading:!0});const t=await l(o.inputValue,a.length);u.current&&u.current.select&&u.current.select.setState({isLoading:!1,[`${i}`]:[...a,...t]})}),500))}))};n?o():t.onclick=o})()}),[l,u]),t(L,{className:"styled-atlaskit-select",classNamePrefix:"styled-atlaskit-select",components:{DropdownIndicator:C,MenuList:S},loadOptions:i,isMulti:s,onChange:n?t=>n(t):void 0,...r,ref:u})},_=({dataQa:e=null,dataQaProps:s=null,...n})=>e?t("div",{"data-qa-id":e,"data-qa-props":s,children:t(V,{...n})}):t(V,{...n});export{_ as SelectAsync,k as reactSelectComponents};
