import{jsxs as e,Fragment as t,jsx as r}from"react/jsx-runtime";import*as s from"react";import{ValidFieldText as o}from"./ValidFieldText.js";import a from"classnames";import i from"react-tooltip";import{s as n}from"../../style-inject.es-1f59c1d0.js";import{Button as d}from"../Button/Button.js";import{translation as l}from"../../utils/i18n/index.js";import"../../fa_icons-aa14317c.js";import p from"dompurify";import{debounce as c}from"../../utils/common.js";import{zxcvbnOptions as m,zxcvbn as h}from"@zxcvbn-ts/core";import{generatePassword as f}from"../../utils/password.js";import{PASSWORD_STRENGTH_METER as g}from"../../constants/password.js";import{DEFAULT_PASSWORD_AND_SECRET_REGEX as w}from"../../constants/common.js";import"@atlaskit/field-text";import"../Form/utility/FormUtility.js";import"../../server-d796a789.js";import"../../index-dd80248b.js";import"stream";import"../../utils/typography.js";import"../../utils/i18n/loadLanguages.js";import"../InlinePopover/InlinePopover.js";import"@atlaskit/inline-dialog";import"../../types/enum.js";import"../../utils/input.js";import"@atlaskit/button";import"randomatic";n('@import url("https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap");.valid-field-password{font-family:Roboto,sans-serif;position:relative}.valid-field-password .password-field-text input{padding-right:24px}.valid-field-password .password-field-text .password-eye-icon{color:#687792;cursor:pointer}.valid-field-password .password-field-text .password-eye-icon:hover{color:#232831}.valid-field-password .generate-password{color:#0b6cff;cursor:pointer;display:inline-block;padding:0;text-decoration:none}.valid-field-password .generate-password>span>span{font-size:12px}.valid-field-password .generate-password :focus{outline:none}.valid-field-password .password-strength-meter .strength-meter-bar{grid-gap:5px;border-radius:4px;display:grid;grid-auto-flow:column;height:5px;margin:10px 0}.valid-field-password .password-strength-meter .strength-meter-bar .bar{background-color:#e1e4e9;border-radius:4px}.valid-field-password .password-strength-meter .strength-meter-bar.veryWeak .fill{background-color:#ac1616}.valid-field-password .password-strength-meter .strength-meter-bar.weak .fill{background-color:#e32626}.valid-field-password .password-strength-meter .strength-meter-bar.fair .fill{background-color:#f1a20a}.valid-field-password .password-strength-meter .strength-meter-bar.strong .fill{background-color:#008940}.valid-field-password .password-strength-meter .strength-meter-bar.veryStrong .fill{background-color:#00642e}.valid-field-password .password-strength-meter .strength-meter-label{color:#687792;font-size:12px}.valid-field-password .password-strength-meter .strength-meter-level{font-size:12px}.valid-field-password .password-strength-meter .strength-meter-level.veryWeak,.valid-field-password .password-strength-meter .strength-meter-level.weak{color:#e32626}.valid-field-password .password-strength-meter .strength-meter-level.fair{color:#d18c09}.valid-field-password .password-strength-meter .strength-meter-level.strong,.valid-field-password .password-strength-meter .strength-meter-level.veryStrong{color:#008940}');class u extends s.Component{constructor(e){super(e),this.state={isIconEyeOff:!0,passwordStrengthScore:0}}toolTipIconEye=s.createRef();componentDidMount(){setTimeout((()=>{i.rebuild()}),100);const{zxcvbnOption:e}=this.props;m.setOptions(e)}componentWillUnmount(){this.hideTooltip()}componentDidUpdate(e){const{hasPasswordStrengthMeter:t,value:r}=this.props;if(r&&r!==e.value||t!==e.hasPasswordStrengthMeter){if(!t)return;this.debounceCalculatePasswordStrength(r)}}toggleIconEyeOff=()=>{this.setState((e=>({isIconEyeOff:!e.isIconEyeOff})),(()=>this.resetTooltipIconEye()))};resetTooltipIconEye=()=>{this.toolTipIconEye&&this.toolTipIconEye.current&&(i.hide(this.toolTipIconEye.current),i.show(this.toolTipIconEye.current))};hideTooltip=()=>{this.toolTipIconEye&&this.toolTipIconEye.current&&i.hide(this.toolTipIconEye.current)};handleEyeIcon=()=>{const{isIconEyeOff:s}=this.state;return e(t,{children:[r("i",{ref:this.toolTipIconEye,"data-for":"eyeInfo__tooltip","data-tip":p.sanitize(l(s?"password.viewPassword":"password.hiddenPassword")),"data-html":!0,"data-place":"top",className:a("password-eye-icon",{"icon-eye":!s,"icon-eye-off":s}),onClick:this.toggleIconEyeOff}),r(i,{effect:"solid",id:"eyeInfo__tooltip"})]})};handleFieldType=()=>this.state.isIconEyeOff?"password":"text";handleGeneratePassword=()=>{const{customPattern:e,onChange:t,name:r}=this.props;if(!t)return;t({target:{name:r,value:f(e||w)}})};handleGenerateText=()=>{const{hasGeneratePassword:s,customField:o,hasPasswordStrengthMeter:i,passwordStrengthDataQa:n}=this.props,{passwordStrengthScore:p}=this.state,c=this.getStrengthLevelBasedOnScore(p);return e(t,{children:[i&&null!==p&&e("div",{className:"password-strength-meter",children:[r("div",{className:a("strength-meter-bar",c),"data-qa-id":n?.bar,children:Object.keys(g).map(((e,t)=>r("div",{className:a("bar",{fill:t<=p}),"data-qa-props":n?.barProps&&`${n.barProps}-${t}`},`bar-${e}`)))}),r("span",{className:a("strength-meter-label"),children:l("password.strength.label")}),r("span",{className:a("strength-meter-level",c),"data-qa-id":n?.label,children:l(`password.strength.level.${c}`)})]}),s&&r(d,{appearance:"link",spacing:"none",className:"generate-password",onClick:this.handleGeneratePassword,children:l("password.generateNew")}),o]})};getStrengthLevelBasedOnScore=e=>{switch(e){case 0:return g.veryWeak;case 1:return g.weak;case 2:return g.fair;case 3:return g.strong;case 4:return g.veryStrong}};calculatePasswordStrength=e=>{if(!e)return this.setState({passwordStrengthScore:null});const{score:t}=h(e);this.setState({passwordStrengthScore:t})};debounceCalculatePasswordStrength=c(this.calculatePasswordStrength,100);render(){return r("div",{className:"valid-field-password",children:r(o,{...this.props,suffixField:this.handleEyeIcon(),type:this.handleFieldType(),className:a(this.props.className,"password-field-text"),customField:this.handleGenerateText()})})}}export{u as ValidFieldPassword};
